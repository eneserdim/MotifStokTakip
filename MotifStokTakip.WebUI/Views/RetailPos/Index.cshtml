@model MotifStokTakip.WebUI.Controllers.PagedList<MotifStokTakip.WebUI.Controllers.RetailPosIndexVM>
@{
    ViewData["Title"] = "Ürün Satışları";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">@ViewData["Title"]</h3>
    <a class="btn btn-primary" asp-action="Create">Yeni Satış</a>
</div>

<form method="get" class="card mb-3">
    <div class="card-body row g-2 align-items-end">
        <div class="col-12 col-md-4">
            <label class="form-label">Arama</label>
            <input type="text" name="q" value="@(ViewBag.Search ?? "")" class="form-control"
                   placeholder="Müşteri adı, ID, kayıt dışı müşteri adı..." />
        </div>
        <div class="col-6 col-md-3">
            <label class="form-label">Başlangıç</label>
            <input type="date" name="from" value="@(ViewBag.From ?? "")" class="form-control" />
        </div>
        <div class="col-6 col-md-3">
            <label class="form-label">Bitiş</label>
            <input type="date" name="to" value="@(ViewBag.To ?? "")" class="form-control" />
        </div>
        <div class="col-12 col-md-2 d-flex gap-2">
            <button type="submit" class="btn btn-primary w-100">Filtrele</button>
            <a asp-action="Index" class="btn btn-outline-secondary w-100">Temizle</a>
        </div>
    </div>
</form>

<div class="card">
    <div class="card-body table-responsive">
        <table class="table table-striped table-hover align-middle" class="table table-sm table-striped align-middle">
            <thead>
                <tr>
                    <th style="width:90px">#</th>
                    <th style="width:180px">Tarih</th>
                    <th>Müşteri</th>
                    <th class="text-center" style="width:120px">Kalem</th>
                    <th class="text-end" style="width:160px">Toplam</th>
                    <th class="text-end" style="width:120px"></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var x in Model.Items)
                {
                    <tr>
                        <td>@x.Id</td>
                        <td>@x.CreatedAt.ToLocalTime().ToString("dd.MM.yyyy HH:mm")</td>
                        <td>@x.Customer</td>
                        <td class="text-center">@x.ItemCount</td>
                        <td class="text-end">@x.Total.ToString("N2") ₺</td>
                        <td class="text-end">
                            <a asp-action="Details" asp-route-id="@x.Id" class="btn btn-outline-secondary btn-sm">Detay</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <!-- Sayfalama -->
        @if (Model.TotalPages > 1)
        {
            <nav class="d-flex justify-content-end">
                <ul class="pagination pagination-sm mb-0">
                    <li class="page-item @(Model.HasPrev ? "" : "disabled")">
                        <a class="page-link"
                           asp-action="Index"
                           asp-route-page="@(Model.Page - 1)"
                           asp-route-q="@ViewBag.Search"
                           asp-route-from="@ViewBag.From"
                           asp-route-to="@ViewBag.To">Önceki</a>
                    </li>

                    @for (var p = 1; p <= Model.TotalPages; p++)
                    {
                        <li class="page-item @(p == Model.Page ? "active" : "")">
                            <a class="page-link"
                               asp-action="Index"
                               asp-route-page="@p"
                               asp-route-q="@ViewBag.Search"
                               asp-route-from="@ViewBag.From"
                               asp-route-to="@ViewBag.To">@p</a>
                        </li>
                    }

                    <li class="page-item @(Model.HasNext ? "" : "disabled")">
                        <a class="page-link"
                           asp-action="Index"
                           asp-route-page="@(Model.Page + 1)"
                           asp-route-q="@ViewBag.Search"
                           asp-route-from="@ViewBag.From"
                           asp-route-to="@ViewBag.To">Sonraki</a>
                    </li>
                </ul>
            </nav>
        }
    </div>
</div>
